---
title: kafka 学习系列 02-kafka生产者与消费者
category: kafka 
tag: java,kafka
date: 2018-05-20 22:00:00
---

## kafka 生产者流程

下图展示了kafka发送消息的整体流程

1. 创建一个ProductRecord对象(对象包含主题名称,分区,key,value).
1. 把key和value 序列化成字节数组.
1. 如果ProductRecord对象没有指定了分区,那么分区器会通过key选择一个分区,如果指定了分区的话直接返回
1. 被序列化后的这条记录会被发往一个记录批次里,这个批次里面的所有消息都是发往相同的主题和相同的分区的
1. 会有专门的线程把这些记录批次发到响应的broker上
1. 服务器收到消息会返回一个响应,如果写如成功就会返回一个RecordMetaData对象(包含了主题和分区信息以及分区的偏移量)
1. 如果不成功,则会返回一个错误,某些错误在生产这收到后会重新尝试发送消息,几次后如果还是失败,就返回失败信息

## 同步发送消息

## 异步发送消息

### 生产者关键配置
